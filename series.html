<!DOCTYPE html>



<html lang="es">



<head>



  <meta charset="UTF-8" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />



  <title>Series - UltraFilm</title>



  <link rel="manifest" href="manifest.json">



  <meta name="theme-color" content="#121212">



  <script>



    



    if ('serviceWorker' in navigator) {



      window.addEventListener('load', () => {



        navigator.serviceWorker.register('sw.js');



      });



    }



  </script>



  <style>



    body {



      margin: 0;



      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;



      background-color: #121212;



      color: #eee;



      display: flex;



      flex-direction: column;



      min-height: 100vh;



    }



    header {



      background-color: #1c1c1c;



      padding: 15px 20px;



      text-align: center;



      font-size: 1.8rem;



      font-weight: bold;



      color: #e50914;



      letter-spacing: 1px;



    }



    nav {



      background-color: #222;



      padding: 10px 20px;



      display: flex;



      justify-content: center;



      flex-wrap: wrap;



      gap: 15px;



    }



    nav a {



      color: #eee;



      text-decoration: none;



      font-weight: bold;



      padding: 8px 15px;



      border-radius: 5px;



      background-color: #333;



      transition: background-color 0.3s ease;



    }



    nav a:hover {



      background-color: #e50914;



    }



    nav a[href="guardados.html"]:hover {



      background-color: #e50914 !important;



      color: #fff !important;



    }



    .btn-logout {



      background: linear-gradient(90deg, #e50914 60%, #b20710 100%);



      color: #fff;



      border-radius: 6px;



      padding: 10px 22px;



      font-size: 1rem;



      font-weight: bold;



      margin: 0 0 0 10px;



      box-shadow: 0 2px 8px rgba(229,9,20,0.10);



      transition: background 0.2s, box-shadow 0.2s, transform 0.1s;



      display: inline-block;



      border: none;



      outline: none;



      cursor: pointer;



      letter-spacing: 0.5px;



    }



    .btn-logout:hover {



      background: linear-gradient(90deg, #b20710 60%, #e50914 100%);



      box-shadow: 0 4px 16px rgba(229,9,20,0.18);



      transform: translateY(-1px) scale(1.04);



    }



    main {



      flex-grow: 1;



      max-width: 1200px;



      margin: 20px auto;



      padding: 0 15px 40px;



    }



    #search-input {



      width: 100%;



      max-width: 300px;



      font-size: 1rem;



      padding: 8px 12px;



      margin-bottom: 25px;



      border-radius: 6px;



      border: none;



      background-color: #222;



      color: #eee;



    }



    #search-input::placeholder {



      color: #aaa;



    }



    #genre-select {



      width: 100%;



      max-width: 300px;



      font-size: 1rem;



      padding: 8px 12px;



      margin-bottom: 25px;



      border-radius: 6px;



      border: none;



      background-color: #222;



      color: #eee;



      cursor: pointer;



      transition: background-color 0.3s ease;



    }



    #genre-select:hover,



    #genre-select:focus {



      background-color: #333;



      outline: none;



    }



    #sort-select {



      width: 100%;



      max-width: 180px;



      font-size: 1rem;



      padding: 8px 12px;



      margin-bottom: 25px;



      border-radius: 6px;



      border: none;



      background-color: #222;



      color: #eee;



      margin-left: 10px;



      cursor: pointer;



      transition: background-color 0.3s ease;



    }



    #sort-select:hover,



    #sort-select:focus {



      background-color: #333;



      outline: none;



    }



    #series-container {

  display: grid;

  grid-template-columns: repeat(6, 1fr);

  gap: 20px;

  min-height: calc(3 * 300px); 

}



/* Ajustes responsive para tablets */

@media (max-width: 1024px) {

  #series-container {

    grid-template-columns: repeat(4, 1fr);

    gap: 15px;

  }

  

  main {

    padding: 0 10px 30px;

  }

}



/* Ajustes responsive para m√≥viles */

@media (max-width: 600px) {

  header {

    font-size: 1.4rem;

    padding: 12px 15px;

  }



  nav {

    padding: 8px 10px;

    gap: 8px;

  }



  nav a {

    padding: 6px 12px;

    font-size: 0.9rem;

  }



  .btn-logout {

    padding: 8px 16px;

    font-size: 0.9rem;

  }



  main {

    padding: 0 8px 20px;

    margin: 15px auto;

  }



  #search-input,

  #genre-select,

  #sort-select {

    font-size: 0.9rem;

    padding: 6px 10px;

    margin-bottom: 15px;

  }



  #sort-select {

    margin-left: 6px;

  }



  #series-container {

    grid-template-columns: repeat(2, 1fr);

    gap: 12px;

  }



  .card {

    border-radius: 8px;

  }



  .card img {

    height: 180px;

  }



  .card-content {

    padding: 8px;

  }



  .card-title {

    font-size: 1rem;

    margin: 0 0 8px 0;

  }



  .card-description {

    font-size: 0.85rem;

    max-height: 54px;

    margin-bottom: 8px;

  }



  .fav-star-btn {

    top: 8px;

    right: 8px;

  }



  .fav-star-btn svg {

    width: 20px;

    height: 20px;

  }



}



    .card {



      background-color: #1e1e1e;



      border-radius: 10px;



      overflow: hidden;



      box-shadow: 0 0 10px rgba(0,0,0,0.7);



      display: flex;



      flex-direction: column;



      color: #ccc;



      transition: transform 0.25s cubic-bezier(.4,0,.2,1), box-shadow 0.25s cubic-bezier(.4,0,.2,1), opacity 0.25s;



      cursor: pointer;



      user-select: none;



      position: relative;



    }



    .card.removing {



      opacity: 0;



      transform: scale(0.95);



      transition: opacity 0.25s, transform 0.25s;



    }



    .card:hover {



      transform: scale(1.05);



      box-shadow: 0 0 15px #e50914;



    }



    .card img {



      width: 100%;



      height: 270px;



      object-fit: cover;



      border-bottom: 1px solid #333;



    }



    .card-content {



      padding: 10px;



      flex-grow: 1;



      display: flex;



      flex-direction: column;



      justify-content: space-between;



    }



    .card-title {



      font-size: 1.1rem;



      margin: 0 0 10px 0;



      color: #e50914;



    }



    .card-description {



      font-size: 0.9rem;



      overflow: hidden;



      max-height: 60px;



      text-overflow: ellipsis;



    }



    



    .fav-star-btn {



      position: absolute;



      top: 10px;



      right: 10px;



      background: transparent;



      border: none;



      cursor: pointer;



      font-size: 1.6rem;



      color: #eee;



      transition: color 0.3s ease, transform 0.15s;



      user-select: none;



      z-index: 2;



      filter: drop-shadow(0 0 2px black);



      padding: 0;



      display: flex;



      align-items: center;



      justify-content: center;



    }



    .fav-star-btn:active {



      transform: scale(0.93);



    }



    .fav-star-btn.favorito svg {



      fill: #f1c40f;



      stroke: #f1c40f;



    }



    .fav-star-btn svg {



      width: 24px;



      height: 24px;



      stroke: #eee;



      fill: none;



      stroke-width: 2;



      stroke-linejoin: round;



      stroke-linecap: round;



      transition: fill 0.3s ease, stroke 0.3s ease;



    }



    



    .bookmark-btn {



      position: absolute;



      top: 10px;



      left: 10px;



      background: transparent;



      border: none;



      cursor: pointer;



      padding: 0;



      z-index: 2;



      display: flex;



      align-items: center;



      justify-content: center;



      transition: transform 0.15s;



    }



    .bookmark-btn:active {



      transform: scale(0.93);



    }



    .bookmark-btn svg {



      width: 24px;



      height: 24px;



      stroke-width: 2;



      stroke-linecap: round;



      stroke-linejoin: round;



      transition: stroke 0.3s, fill 0.3s;



    }



    .bookmark-btn.guardado svg {



      stroke: #00b3ff;



    }



    .bookmark-btn.guardado path {



      fill: #00b3ff;



    }



    footer {



      background-color: #1c1c1c;



      text-align: center;



      padding: 15px 10px;



      color: #666;



      font-size: 0.9rem;



    }



    



    .modal {



      position: fixed;



      top: 0; left: 0; right: 0; bottom: 0;



      background: rgba(0,0,0,0.85);



      z-index: 10000;



      display: flex;



      align-items: center;



      justify-content: center;



      transition: opacity 0.3s;



      animation: fadeInModal 0.3s;



    }



    .modal.hide {



      animation: fadeOutModal 0.3s forwards;



    }



    .modal-content {



      background: #181818;



      color: #eee;



      border-radius: 12px;



      max-width: 700px;



      width: 95vw;



      max-height: 90vh;



      overflow-y: auto;



      position: relative;



      box-shadow: 0 0 30px #000;



      padding: 30px 20px 20px 20px;



      outline: none;



    }



    @keyframes fadeInModal {



      from { opacity: 0; }



      to { opacity: 1; }



    }



    @keyframes fadeOutModal {



      to { opacity: 0; pointer-events: none; }



    }



    .modal-close {



      position: absolute;



      top: 12px; right: 18px;



      background: none;



      border: none;



      color: #fff;



      font-size: 2rem;



      cursor: pointer;



      z-index: 2;



      transition: color 0.2s;



    }



    .modal-close:hover { color: #e50914; }



    .modal-movie-header {



      display: flex;



      gap: 20px;



      align-items: flex-start;



      margin-bottom: 18px;



    }



    .modal-movie-poster {



      width: 140px;



      border-radius: 8px;



      box-shadow: 0 2px 10px #000a;



      flex-shrink: 0;



    }



    .modal-movie-info {



      flex: 1;



    }



    .modal-movie-title {



      font-size: 1.5rem;



      color: #e50914;



      margin: 0 0 8px 0;



    }



    .modal-movie-rating {



      font-size: 1.1rem;



      margin-bottom: 8px;



      color: #f1c40f;



    }



    .modal-movie-overview {



      margin-bottom: 16px;



      font-size: 1rem;



      color: #ccc;



    }



    .modal-section-title {



      font-size: 1.1rem;



      color: #e50914;



      margin: 18px 0 8px 0;



    }



    .modal-reviews {



      max-height: 120px;



      overflow-y: auto;



      margin-bottom: 10px;



    }



    .modal-review {



      background: #232323;



      border-radius: 6px;



      padding: 8px 10px;



      margin-bottom: 8px;



      font-size: 0.97rem;



    }



    .modal-review-author {



      font-weight: bold;



      color: #f1c40f;



      margin-bottom: 2px;



      font-size: 0.95em;



    }



    .modal-trailer {



      margin-top: 10px;



      text-align: center;



    }



    .modal-trailer iframe {



      width: 100%;



      max-width: 480px;



      height: 270px;



      border-radius: 8px;



      border: none;



      background: #000;



    }



    /* Ajustes responsive */

    @media (max-width: 1024px) {

      #series-container {

        grid-template-columns: repeat(4, 1fr);

        gap: 15px;

      }

      main { padding: 0 10px 30px; }

      .card img { height: 220px; }

    }

    @media (max-width: 600px) {

      header { font-size: 1.4rem; padding: 12px 15px; }

      nav { padding: 8px 10px; gap: 8px; }

      nav a { padding: 6px 12px; font-size: 0.9rem; }

      .btn-logout { padding: 8px 16px; font-size: 0.9rem; }

      main { padding: 0 8px 20px; margin: 15px auto; }

      #search-input, #genre-select, #sort-select {

        font-size: 0.9rem;

        padding: 6px 10px;

        margin-bottom: 15px;

      }

      #sort-select { margin-left: 6px; }

      #series-container {

        grid-template-columns: repeat(2, 1fr);

        gap: 12px;

      }

      .card { border-radius: 8px; }

      .card img { height: 180px; }

      .card-content { padding: 8px; }

      .card-title { font-size: 1rem; margin: 0 0 8px 0; }

      .card-description {

        font-size: 0.85rem;

        max-height: 54px;

        margin-bottom: 8px;

      }

      .fav-star-btn {

        top: 8px;

        right: 8px;

        font-size: 1.4rem;

      }

    }



      }



      .modal-content { padding: 10px 2vw 10px 2vw; }



      .modal-movie-header { flex-direction: column; align-items: center; }



      .modal-movie-poster { width: 90vw; max-width: 220px; }



    }



    



#toast-container {



  position: fixed;



  top: 30px;



  right: 30px;



  z-index: 99999;



  display: flex;



  flex-direction: column;



  gap: 12px;



  pointer-events: none;



}



.toast {



  min-width: 220px;



  max-width: 350px;



  background: #232323;



  color: #fff;



  padding: 16px 24px;



  border-radius: 8px;



  font-size: 1rem;



  box-shadow: 0 2px 12px rgba(229,9,20,0.18);



  opacity: 0.97;



  pointer-events: auto;



  transition: opacity 0.3s, transform 0.3s;



  animation: toastIn 0.3s;



}



.toast-success { background: linear-gradient(90deg, #43e97b 0%, #38f9d7 100%); color: #222; }



.toast-error { background: linear-gradient(90deg, #e50914 60%, #b20710 100%); color: #fff; }



.toast-info { background: linear-gradient(90deg, #232526 0%, #414345 100%); color: #fff; }



.toast.hide {



  opacity: 0;



  transform: translateY(-20px) scale(0.98);



  transition: opacity 0.3s, transform 0.3s;



}



@keyframes toastIn {



  from { opacity: 0; transform: translateY(-20px) scale(0.98); }



  to { opacity: 0.97; transform: none; }



}



@keyframes toastOut {



  to { opacity: 0; transform: translateY(-20px) scale(0.98); }



}



    .pagination {



      display: flex;



      justify-content: center;



      align-items: center;



      gap: 18px;



      margin: 30px 0 0 0;



    }



    .pagination button {



      background: linear-gradient(90deg, #e50914 60%, #b20710 100%);



      color: #fff;



      border: none;



      border-radius: 6px;



      padding: 10px 22px;



      font-size: 1rem;



      font-weight: bold;



      cursor: pointer;



      transition: background 0.2s, transform 0.1s;



      outline: none;



      box-shadow: 0 2px 8px rgba(229,9,20,0.10);



      min-width: 110px;



      opacity: 1;



    }



    .pagination button:disabled {



      background: #333;



      color: #aaa;



      cursor: not-allowed;



      opacity: 0.7;



    }



    .pagination span {



      color: #e50914;



      font-size: 1.1rem;



      font-weight: bold;



      letter-spacing: 0.5px;



      min-width: 120px;



      text-align: center;



      display: inline-block;



    }



  </style>



</head>



<body>



  <header>üì∫ Series Populares</header>







  <nav>



    <a href="dash.html">Inicio</a>



    <a href="peliculas.html">Pel√≠culas</a>



    <a href="series.html" aria-current="page">Series</a>



    <a href="favoritos.html">Favoritos</a>



    <a href="guardados.html" aria-current="page" style="background:#333;color:#eee;font-weight:bold;">Ver m√°s tarde</a>



    <button id="logout-btn" class="btn-logout">Cerrar sesi√≥n</button>



  </nav>







  <main>



    <input type="text" id="search-input" placeholder="Buscar series..." aria-label="Buscar series por t√≠tulo" style="width:100%;max-width:300px;font-size:1rem;padding:8px 12px;margin-bottom:25px;border-radius:6px;border:none;background-color:#222;color:#eee;" />



    <select id="genre-select" aria-label="Filtrar por g√©nero">



      <option value="0">Todos los g√©neros</option>



    </select>



    <select id="sort-select" aria-label="Ordenar por" style="width:100%;max-width:180px;font-size:1rem;padding:8px 12px;margin-bottom:25px;border-radius:6px;border:none;background-color:#222;color:#eee;margin-left:10px;">



      <option value="popularity.desc">M√°s populares</option>



      <option value="popularity.asc">Menos populares</option>



      <option value="first_air_date.desc">M√°s nuevas</option>



      <option value="first_air_date.asc">M√°s antiguas</option>



      <option value="vote_average.desc">Mejor puntuadas</option>



      <option value="vote_average.asc">Peor puntuadas</option>



      <option value="original_name.asc">T√≠tulo (A-Z)</option>



      <option value="original_name.desc">T√≠tulo (Z-A)</option>



    </select>







    <div id="series-container" aria-live="polite" aria-relevant="additions"></div>







    



    <div class="pagination">



      <button id="prev-page" disabled>Anterior</button>



      <span id="page-indicator">P√°gina 1</span>



      <button id="next-page">Siguiente</button>



    </div>



    



    <div id="serie-modal" class="modal" style="display:none;">



      <div class="modal-content" tabindex="0">



        <button class="modal-close" id="serie-modal-close-btn" aria-label="Cerrar modal">&times;</button>



        <div id="serie-modal-body">



          



        </div>



      </div>



    </div>



  </main>







  <footer>¬© 2025 UltraFilm Cine & Series. Todos los derechos reservados.</footer>







  



  <div id="toast-container" aria-live="polite" aria-atomic="true"></div>







  <script src="/js/tmdb.min.js"></script>
  <script>

    // La API key ahora est√° en el backend, no se necesita aqu√≠
    // IMG_URL sigue siendo p√∫blica (es solo para mostrar im√°genes)
        const IMG_URL = 'https://image.tmdb.org/t/p/w500';







 



let currentPage = 1;



let totalPages = 1;



let currentGenre = 0;



let currentSearchQuery = '';



let currentSort = 'popularity.desc';



let genres = [];



let series = [];







 



const genreSelect = document.getElementById('genre-select');



const sortSelect = document.getElementById('sort-select');



const seriesContainer = document.getElementById('series-container');



const searchInput = document.getElementById('search-input');



const prevPageBtn = document.getElementById('prev-page');



const nextPageBtn = document.getElementById('next-page');



const pageIndicator = document.getElementById('page-indicator');







 



const token = localStorage.getItem('jwt');



const loggedInUser = JSON.parse(localStorage.getItem('loggedInUser'));



if (!token) {



  alert('No hay JWT en localStorage');



  localStorage.removeItem('jwt');



  localStorage.removeItem('loggedInUser');



  window.location.href = 'login.html';



}



if (!loggedInUser || !loggedInUser.id) {



  alert('No hay usuario en localStorage');



  localStorage.removeItem('jwt');



  localStorage.removeItem('loggedInUser');



  window.location.href = 'login.html';



}







 



let searchTimeout;



searchInput.addEventListener('input', () => {



  clearTimeout(searchTimeout);



  searchTimeout = setTimeout(() => {



    currentSearchQuery = searchInput.value.trim();



    currentPage = 1;



    fetchSeries();



  }, 300);



});







 



prevPageBtn.addEventListener('click', () => {



  if (currentPage > 1) {



    currentPage--;



    fetchSeries();



  }



});







nextPageBtn.addEventListener('click', () => {



  if (currentPage < totalPages) {



    currentPage++;



    fetchSeries();



  }



});







 



genreSelect.addEventListener('change', () => {



  currentGenre = parseInt(genreSelect.value);



  currentPage = 1;



  fetchSeries();



});







 



sortSelect.addEventListener('change', () => {



  currentSort = sortSelect.value;



  currentPage = 1;



  fetchSeries();



});







 



async function fetchGenres() {



  try {



    const data = await tmdbFetch('/genre/tv/list', { language: 'es-ES' });



    genres = data.genres || [];



    populateGenreSelect();



  } catch (e) {



    showToast('Error cargando g√©neros', 'error');



  }



}







function populateGenreSelect() {



  genres.forEach(genre => {



    const option = document.createElement('option');



    option.value = genre.id;



    option.textContent = genre.name;



    genreSelect.appendChild(option);



  });



}







 



async function fetchSeries() {



  try {



    let data;



    



    if (currentSearchQuery) {



      data = await tmdbFetch('/search/tv', { 
        language: 'es-ES', 
        query: currentSearchQuery, 
        page: currentPage 
      });



      let results = data.results || [];



      



      if (currentGenre && currentGenre != 0) {



        results = results.filter(s => (s.genre_ids || []).includes(currentGenre));



      }



      



      results = sortSearchResults(results, currentSort);



      series = results;



      totalPages = data.total_pages || 1;



    } else if (currentGenre && currentGenre != 0) {



      data = await tmdbFetch('/discover/tv', {
        language: 'es-ES',
        sort_by: currentSort,
        page: currentPage,
        with_genres: currentGenre
      });



      series = data.results || [];



      totalPages = data.total_pages || 1;



    } else {



      data = await tmdbFetch('/discover/tv', {
        language: 'es-ES',
        sort_by: currentSort,
        page: currentPage
      });



      series = data.results || [];



      totalPages = data.total_pages || 1;



    }



    renderSeries();



    updatePaginationControls();



  } catch (e) {



    showToast('Error al cargar series', 'error');



    seriesContainer.innerHTML = '<p style="color:#e50914;text-align:center;">Error al cargar series.</p>';



  }



}







 



function sortSearchResults(results, sortBy) {



  const [field, dir] = sortBy.split('.');



  return results.slice().sort((a, b) => {



    let va, vb;



    switch (field) {



      case 'popularity':



        va = a.popularity; vb = b.popularity; break;



      case 'first_air_date':



        va = a.first_air_date || ''; vb = b.first_air_date || ''; break;



      case 'vote_average':



        va = a.vote_average; vb = b.vote_average; break;



      case 'original_name':



        va = (a.original_name || '').toLowerCase(); vb = (b.original_name || '').toLowerCase(); break;



      default:



        va = 0; vb = 0;



    }



    if (va < vb) return dir === 'asc' ? -1 : 1;



    if (va > vb) return dir === 'asc' ? 1 : -1;



    return 0;



  });



}







 



let favoritos = [];



let favoritosCargados = false;



async function fetchFavoritos(force = false) {



  if (!loggedInUser || !loggedInUser.id) return favoritos = [];



  if (favoritosCargados && !force) return favoritos;



  try {



  const res = await safeFetch(`https://api.ultrafilm.online/favoritos?user_id=${loggedInUser.id}`);



    favoritos = res;



    favoritosCargados = true;



  } catch (e) {



    favoritos = [];



    showToast('Error al cargar tus favoritos.', 'error');



  }



}



function esFavorito(id) {



  return favoritos.some(fav => fav.id === id);



}



async function toggleFavorito(serie) {



  if (!loggedInUser || !loggedInUser.id) return;



  const fav = favoritos.find(f => f.id === serie.id);



  try {



    if (fav) {



  await safeFetch('https://api.ultrafilm.online/favoritos', {



        method: 'DELETE',



        headers: { 'Content-Type': 'application/json' },



        body: JSON.stringify({ user_id: loggedInUser.id, serie_id: serie.id })



      });



      showToast(`Eliminaste "${serie.name}" de favoritos.`, 'error');



    } else {



  await safeFetch('https://api.ultrafilm.online/favoritos', {



        method: 'POST',



        headers: { 'Content-Type': 'application/json' },



        body: JSON.stringify({ user_id: loggedInUser.id, serie })



      });



      showToast(`Agregaste "${serie.name}" a favoritos.`, 'success');



    }



    favoritosCargados = false;



    await fetchFavoritos(true);



    renderSeries();



  } catch (e) {



    showToast('No se pudo actualizar favoritos.', 'error');



  }



}







// --- GUARDADOS API (ver m√°s tarde) ---



let guardados = [];



let guardadosCargados = false;



async function fetchGuardados(force = false) {



  if (!loggedInUser || !loggedInUser.id) return guardados = [];



  if (guardadosCargados && !force) return guardados;



  try {



  const res = await safeFetch(`https://api.ultrafilm.online/guardados?user_id=${loggedInUser.id}`);



    guardados = res;



    guardadosCargados = true;



  } catch (e) {



    guardados = [];



  }



}



function estaGuardado(id) {



  return guardados.some(g => g.id === id);



}



async function toggleGuardado(serie) {



  if (!loggedInUser || !loggedInUser.id) return;



  const guardado = guardados.find(g => g.id === serie.id);



  if (guardado) {



  await safeFetch('https://api.ultrafilm.online/guardados', {



      method: 'DELETE',



      headers: { 'Content-Type': 'application/json', 'Authorization': 'Bearer ' + token },



      body: JSON.stringify({ user_id: loggedInUser.id, serie_id: serie.id })



    });



    showToast(`Eliminaste "${serie.name}" de ver m√°s tarde.`, 'success');



  } else {



  await safeFetch('https://api.ultrafilm.online/guardados', {



      method: 'POST',



      headers: { 'Content-Type': 'application/json', 'Authorization': 'Bearer ' + token },



      body: JSON.stringify({ user_id: loggedInUser.id, serie })



    });



    showToast(`Guardaste "${serie.name}" para ver m√°s tarde.`, 'success');



  }



  guardadosCargados = false;



  await fetchGuardados(true);



  renderSeries();



}







    // Modificar los listeners de g√©nero, sort y b√∫squeda para reiniciar a p√°gina 1



    searchInput.addEventListener('input', () => {



      clearTimeout(searchTimeout);



      searchTimeout = setTimeout(() => {



        currentSearchQuery = searchInput.value.trim();



        fetchSeries(parseInt(genreSelect.value), 1);



      }, 300);



    });



    sortSelect.addEventListener('change', () => {



      currentSort = sortSelect.value;



      fetchSeries(parseInt(genreSelect.value), 1);



    });



    genreSelect.addEventListener('change', () => {



      currentGenre = parseInt(genreSelect.value);



      fetchSeries(currentGenre, 1);



    });







    // Modal l√≥gica



    const serieModal = document.getElementById('serie-modal');



    const serieModalBody = document.getElementById('serie-modal-body');



    const serieModalCloseBtn = document.getElementById('serie-modal-close-btn');







    function openSerieModal(serieId) {



      showSerieDetails(serieId);



      serieModal.style.display = 'flex';



      document.body.style.overflow = 'hidden';



      setTimeout(() => {



        serieModal.querySelector('.modal-content').focus();



      }, 100);



    }







    function closeSerieModal() {



      serieModal.style.display = 'none';



      document.body.style.overflow = '';



      serieModalBody.innerHTML = '';



    }







    serieModalCloseBtn.addEventListener('click', closeSerieModal);



    serieModal.addEventListener('click', (e) => {



      if (e.target === serieModal) closeSerieModal();



    });



    document.addEventListener('keydown', (e) => {



      if (serieModal.style.display === 'flex' && e.key === 'Escape') closeSerieModal();



    });







    async function showSerieDetails(serieId) {



      serieModalBody.innerHTML = '<div style="text-align:center;padding:40px 0;">Cargando...</div>';



      try {



        // Detalles



        const [details, reviewsData, videosData] = await Promise.all([

          tmdbFetch(`/tv/${serieId}`, { language: 'es-ES' }),

          tmdbFetch(`/tv/${serieId}/reviews`, { language: 'es-ES', page: 1 }),

          tmdbFetch(`/tv/${serieId}/videos`, { language: 'es-ES' })

        ]);







        // Trailer (YouTube preferido)



        let trailer = null;



        if (videosData.results && videosData.results.length) {



          trailer = videosData.results.find(v => v.type === 'Trailer' && v.site === 'YouTube') ||



                    videosData.results.find(v => v.site === 'YouTube');



        }







        // Reviews



        const reviews = (reviewsData.results || []).slice(0, 4);







        serieModalBody.innerHTML = `



          <div class="modal-movie-header">



            <img class="modal-movie-poster" src="${details.poster_path ? IMG_URL + details.poster_path : 'https://via.placeholder.com/500x750?text=Sin+Imagen'}" alt="Poster de ${details.name}" />



            <div class="modal-movie-info">



              <h2 class="modal-movie-title">${details.name}</h2>



              <div class="modal-movie-rating">‚≠ê ${details.vote_average ? details.vote_average.toFixed(1) : 'N/A'} / 10 (${details.vote_count || 0} votos)</div>



              <div class="modal-movie-overview">${details.overview || 'Sin descripci√≥n.'}</div>



              <div><b>G√©neros:</b> ${details.genres && details.genres.length ? details.genres.map(g => g.name).join(', ') : 'N/A'}</div>



              <div><b>Fecha de estreno:</b> ${details.first_air_date || 'N/A'}</div>



              <div><b>Temporadas:</b> ${details.number_of_seasons || 'N/A'} | <b>Episodios:</b> ${details.number_of_episodes || 'N/A'}</div>



              <div style="margin-top:10px;">



                <b>Ver m√°s:</b>



                <a href="https://www.themoviedb.org/tv/${details.id}" target="_blank" rel="noopener" style="color:#00b3ff;">TMDB</a>



                ${details.homepage ? `| <a href="${details.homepage}" target="_blank" rel="noopener" style="color:#00ff99;">Sitio Oficial</a>` : ''}



              </div>



            </div>



          </div>



          <div>



            <div class="modal-section-title">Rese√±as</div>



            <div class="modal-reviews">



              ${reviews.length ? reviews.map(r => `



                <div class="modal-review">



                  <div class="modal-review-author">${r.author}</div>



                  <div>${r.content.length > 300 ? r.content.slice(0, 300) + '...' : r.content}</div>



                </div>



              `).join('') : '<div style="color:#aaa;">No hay rese√±as disponibles.</div>'}



            </div>



          </div>



          <div>



            <div class="modal-section-title">Trailer</div>



            <div class="modal-trailer">



              ${trailer ? `<iframe src="https://www.youtube.com/embed/${trailer.key}" allowfullscreen title="Trailer"></iframe>` : '<div style="color:#aaa;">No hay trailer disponible.</div>'}



            </div>



          </div>



        `;



      } catch (e) {



        serieModalBody.innerHTML = '<div style="color:#e50914;text-align:center;padding:40px 0;">Error al cargar detalles.</div>';



      }



    }







    async function renderSeries() {



      if (!series.length) {



        seriesContainer.innerHTML = '<p style="color:#ccc; text-align:center;">No se encontraron series.</p>';



        return;



      }



      await Promise.all([fetchFavoritos(), fetchGuardados()]);



      seriesContainer.innerHTML = series.map(s => {



        const favorito = esFavorito(s.id);



        const guardado = estaGuardado(s.id);



        return `



          <article class="card" tabindex="0" aria-label="Serie: ${s.name}" data-serie-id="${s.id}">



            <button class="fav-star-btn ${favorito ? 'favorito' : ''}" aria-pressed="${favorito}" aria-label="${favorito ? 'Eliminar de favoritos' : 'Agregar a favoritos'}" data-id="${s.id}">



              <svg xmlns="http://www.w3.org/2000/svg" fill="${favorito ? '#f1c40f' : 'none'}" stroke="${favorito ? '#f1c40f' : '#eee'}" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true" focusable="false">



                <path stroke-linejoin="round" stroke-linecap="round" d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/>



              </svg>



            </button>



            <button class="bookmark-btn${guardado ? ' guardado' : ''}" aria-pressed="${guardado}" aria-label="${guardado ? 'Quitar de ver m√°s tarde' : 'Guardar para ver m√°s tarde'}" data-id="${s.id}" tabindex="0" style="position:absolute;top:10px;left:10px;background:transparent;border:none;cursor:pointer;padding:0;z-index:2;display:flex;align-items:center;justify-content:center;">



              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="${guardado ? '#00b3ff' : '#eee'}" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">



                <path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z" fill="${guardado ? '#00b3ff' : 'none'}"/>



              </svg>



            </button>



            <img src="${s.poster_path ? IMG_URL + s.poster_path : 'no-image.png'}" alt="Poster de ${s.name}" loading="lazy" decoding="async" />



            <div class="card-content">



              <h3 class="card-title">${s.name}</h3>



              <p class="card-description">${s.overview ? s.overview.slice(0, 100) + (s.overview.length > 100 ? '...' : '') : 'Sin descripci√≥n.'}</p>



            </div>



          </article>



        `;



      }).join('');







      // Bot√≥n favoritos



      document.querySelectorAll('.fav-star-btn').forEach(btn => {



        btn.addEventListener('click', function(e) {



          e.stopPropagation();



          const serieId = parseInt(btn.getAttribute('data-id'));



          const serie = series.find(s => s.id === serieId);



          if (serie) toggleFavorito(serie);



        });



      });



      // Bot√≥n ver m√°s tarde (bookmark)



      document.querySelectorAll('.bookmark-btn').forEach(btn => {



        btn.addEventListener('click', function(e) {



          e.stopPropagation();



          const serieId = parseInt(btn.getAttribute('data-id'));



          const serie = series.find(s => s.id === serieId);



          if (serie) toggleGuardado(serie);



        });



      });



      // Modal



      document.querySelectorAll('.card').forEach(card => {



        card.addEventListener('click', function(e) {



          if (e.target.closest('.fav-star-btn') || e.target.closest('.bookmark-btn')) return;



          const serieId = this.getAttribute('data-serie-id');



          openSerieModal(serieId);



        });



        card.addEventListener('keydown', function(e) {



          if ((e.key === 'Enter' || e.key === ' ') && !e.target.closest('.fav-star-btn') && !e.target.closest('.bookmark-btn')) {



            e.preventDefault();



            const serieId = this.getAttribute('data-serie-id');



            openSerieModal(serieId);



          }



        });



      });



    }







function updatePaginationControls() {



  pageIndicator.textContent = `P√°gina ${currentPage} de ${totalPages}`;



  prevPageBtn.disabled = currentPage <= 1;



  nextPageBtn.disabled = currentPage >= totalPages;



}







    // Logout robusto (igual que peliculas.html)



document.getElementById('logout-btn').addEventListener('click', async () => {



  if (token) {



    try {



  await fetch('https://api.ultrafilm.online/logout', {



        method: 'POST',



        headers: { 'Authorization': 'Bearer ' + token }



      });



    } catch {}



  }



  localStorage.removeItem('adminToken');



  localStorage.removeItem('jwt');



  localStorage.removeItem('loggedInUser');



  window.location.href = 'login.html';



});







    // Toast notification system



function showToast(message, type = 'info', duration = 3500) {



  const container = document.getElementById('toast-container');



  const toast = document.createElement('div');



  toast.className = `toast toast-${type}`;



  toast.textContent = message;



  container.appendChild(toast);



  setTimeout(() => {



    toast.classList.add('hide');



    toast.addEventListener('transitionend', () => toast.remove());



  }, duration);



}







// Safe fetch wrapper para rutas protegidas (igual que peliculas.html)



async function safeFetch(url, options = {}) {



  options.headers = options.headers || {};



  if (url.startsWith('https://api.ultrafilm.online')) {



    options.headers['Authorization'] = 'Bearer ' + token;



  }



  try {



    const res = await fetch(url, options);



    if (!res.ok) {



      let errMsg = `Error ${res.status}`;



      try {



        const data = await res.json();



        errMsg = data.error || errMsg;



      } catch {}



      throw new Error(errMsg);



    }



    return await res.json();



  } catch (err) {



    showToast(err.message || 'Error de conexi√≥n con el servidor.', 'error');



    throw err;



  }



}







document.addEventListener('DOMContentLoaded', () => {



  fetchGenres().then(async () => {



    await Promise.all([fetchFavoritos(), fetchGuardados()]);



    fetchSeries(0, 1);



  });



});



  </script>

  <script src="/js/maintenance.js" defer></script>



</body>



</html>



